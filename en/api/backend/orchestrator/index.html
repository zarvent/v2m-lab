
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentación oficial de Voice2Machine">
      
      
      
        <link rel="canonical" href="https://voice2machine.local/en/api/backend/orchestrator/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../api/">
      
      
        
          <link rel="alternate" href="../../../../api/backend/orchestrator/" hreflang="es">
        
          <link rel="alternate" href="./" hreflang="en">
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Orchestrator - Voice2Machine</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#orchestrator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../" title="Voice2Machine" class="md-header__button md-logo" aria-label="Voice2Machine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Voice2Machine
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Orchestrator
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../../api/backend/orchestrator/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zarvent/v2m-lab" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../" title="Voice2Machine" class="md-nav__button md-logo" aria-label="Voice2Machine" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Voice2Machine
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zarvent/v2m-lab" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Exploration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Exploration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guia_rapida/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../glosario/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Procedures
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Procedures
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../instalacion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contribucion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuracion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../atajos_teclado/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Keyboard Shortcuts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../referencia_api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Python API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Backend
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Backend
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Orchestrator
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestrator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        clipboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        llm_service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        notifications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.recorder" class="md-nav__link">
    <span class="md-ellipsis">
      
        recorder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="md-nav__link">
    <span class="md-ellipsis">
      
        transcriber
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.worker" class="md-nav__link">
    <span class="md-ellipsis">
      
        worker
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        process_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        shutdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.toggle" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        translate_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.warmup" class="md-nav__link">
    <span class="md-ellipsis">
      
        warmup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../transcription/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transcripción
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Servicios LLM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../interfaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domain/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Domain
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../arquitectura/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Decisions (ADR)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Decisions (ADR)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/001-fastapi-migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001: FastAPI Migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/002-orchestrator-pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002: Orchestrator Pattern
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/003-faster-whisper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003: faster-whisper
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/004-hexagonal-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004: Hexagonal Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/005-rust-audio-engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005: Rust Audio Engine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../adr/006-local-first/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006: Local-first
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Diagnostics
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Diagnostics
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Maintenance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maintenance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Governance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Governance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../style_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Style Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator" class="md-nav__link">
    <span class="md-ellipsis">
      
        Orchestrator
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Orchestrator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        clipboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="md-nav__link">
    <span class="md-ellipsis">
      
        llm_service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.notifications" class="md-nav__link">
    <span class="md-ellipsis">
      
        notifications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.recorder" class="md-nav__link">
    <span class="md-ellipsis">
      
        recorder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="md-nav__link">
    <span class="md-ellipsis">
      
        transcriber
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.worker" class="md-nav__link">
    <span class="md-ellipsis">
      
        worker
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.get_status" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_status
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.process_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        process_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      
        shutdown
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.start" class="md-nav__link">
    <span class="md-ellipsis">
      
        start
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.stop" class="md-nav__link">
    <span class="md-ellipsis">
      
        stop
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.toggle" class="md-nav__link">
    <span class="md-ellipsis">
      
        toggle
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="md-nav__link">
    <span class="md-ellipsis">
      
        translate_text
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#v2m.services.orchestrator.Orchestrator.warmup" class="md-nav__link">
    <span class="md-ellipsis">
      
        warmup
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="orchestrator">Orchestrator<a class="headerlink" href="#orchestrator" title="Permanent link">&para;</a></h1>
<p>The Orchestrator is the central service that coordinates the entire Voice2Machine workflow.</p>
<hr />
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-class">



<h2 id="v2m.services.orchestrator.Orchestrator" class="doc doc-heading">
              <code class="highlight language-python"><span class="n">v2m</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">orchestrator</span><span class="o">.</span><span class="n">Orchestrator</span><span class="p">(</span><span class="n">broadcast_fn</span><span class="p">:</span> <span class="n">BroadcastFn</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

<a href="#v2m.services.orchestrator.Orchestrator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents first">



        <p>Orquestador central del sistema Voice2Machine.</p>
<p>Coordina todos los servicios del sistema (audio, transcripción, LLM, clipboard,
notificaciones) usando Lazy Initialization. Reemplaza el patrón CQRS + DI Container
con un enfoque más directo y fácil de depurar.</p>
<p>El Orchestrator es el único punto de entrada para las operaciones de negocio.
FastAPI delega todas las acciones aquí, manteniendo los endpoints "tontos".</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._is_recording">_is_recording</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estado actual de grabación (True si está capturando audio).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._model_loaded">_model_loaded</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True si el modelo Whisper está pre-cargado en VRAM.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="v2m.services.orchestrator.Orchestrator._broadcast_fn">_broadcast_fn</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Función opcional para emitir eventos a WebSocket clients.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Los servicios pesados (Whisper, LLM) se crean cuando se necesitan por primera
vez, no al inicio. Esto permite que el servidor FastAPI arranque en ~100ms.
Ver: docs/adr/002-orchestrator-pattern.md</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>async def main():
...     orch = Orchestrator()
...     await orch.warmup()  # Pre-cargar Whisper en VRAM
...     response = await orch.toggle()
...     print(response.text)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
        <p>Inicializa el orquestador con estado limpio y servicios diferidos.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>broadcast_fn</code>
            </td>
            <td>
                  <code><span title="v2m.services.orchestrator.BroadcastFn">BroadcastFn</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Función opcional para enviar eventos en tiempo real
a clientes WebSocket. Usada para transcripción provisional.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Los servicios reales (WhisperWorker, AudioRecorder, etc.) no se
crean aquí. Se instancian en su primera llamada (Lazy Init).</p>
</details>







                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">broadcast_fn</span><span class="p">:</span> <span class="n">BroadcastFn</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el orquestador con estado limpio y servicios diferidos.</span>

<span class="sd">    Args:</span>
<span class="sd">        broadcast_fn: Función opcional para enviar eventos en tiempo real</span>
<span class="sd">            a clientes WebSocket. Usada para transcripción provisional.</span>

<span class="sd">    Note:</span>
<span class="sd">        Los servicios reales (WhisperWorker, AudioRecorder, etc.) no se</span>
<span class="sd">        crean aquí. Se instancian en su primera llamada (Lazy Init).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Estado interno</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_broadcast_fn</span> <span class="o">=</span> <span class="n">broadcast_fn</span>

    <span class="c1"># Servicios con lazy initialization (None hasta que se usen)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span> <span class="n">PersistentWhisperWorker</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_recorder</span><span class="p">:</span> <span class="n">AudioRecorder</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_transcriber</span><span class="p">:</span> <span class="n">StreamingTranscriber</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_clipboard</span><span class="p">:</span> <span class="n">LinuxClipboardAdapter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span> <span class="n">LinuxNotificationService</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_llm_service</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Tipo dinámico según backend</span>
</code></pre></div></td></tr></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.clipboard" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clipboard</span><span class="p">:</span> <span class="n">LinuxClipboardAdapter</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.clipboard" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio de clipboard del sistema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LinuxClipboardAdapter</code></td>            <td>
                  <code><span title="v2m.infrastructure.linux_adapters.LinuxClipboardAdapter">LinuxClipboardAdapter</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapper sobre xclip/wl-copy según el entorno.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.llm_service" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">llm_service</span><span class="p">:</span> <span class="n">Any</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.llm_service" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio LLM configurado, creándolo si no existe.</p>
<p>Selecciona el backend según config.llm.backend:
- "gemini": Google Gemini API (cloud)
- "ollama": Ollama local
- "local": Modelo embebido</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMService</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia del proveedor configurado.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>El tipo de retorno es Any porque los backends tienen interfaces
similares pero no idénticas. En producción, todos implementan
process_text(str) -&gt; str y translate_text(str, str) -&gt; str.</p>
</details>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">notifications</span><span class="p">:</span> <span class="n">LinuxNotificationService</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.notifications" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el servicio de notificaciones de escritorio.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LinuxNotificationService</code></td>            <td>
                  <code><span title="v2m.infrastructure.notification_service.LinuxNotificationService">LinuxNotificationService</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wrapper sobre notify-send/libnotify.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.recorder" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recorder</span><span class="p">:</span> <span class="n">AudioRecorder</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.recorder" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el grabador de audio, creándolo si no existe.</p>
<p>Utiliza la extensión Rust (v2m_engine) para captura de baja latencia.
Ver: docs/adr/005-rust-audio-engine.md</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>AudioRecorder</code></td>            <td>
                  <code><span title="v2m.infrastructure.audio.recorder.AudioRecorder">AudioRecorder</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia configurada para 16kHz mono (requerido por Whisper).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.transcriber" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transcriber</span><span class="p">:</span> <span class="n">StreamingTranscriber</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.transcriber" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el transcriptor streaming, creándolo si no existe.</p>
<p>Conecta AudioRecorder → WhisperWorker → WebSocket broadcast para
proporcionar transcripción provisional en tiempo real.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StreamingTranscriber</code></td>            <td>
                  <code><span title="v2m.infrastructure.streaming_transcriber.StreamingTranscriber">StreamingTranscriber</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia conectada al worker y recorder.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="v2m.services.orchestrator.Orchestrator.worker" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">worker</span><span class="p">:</span> <span class="n">PersistentWhisperWorker</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.worker" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Obtiene el worker de Whisper, creándolo si no existe.</p>
<p>El worker gestiona el modelo Whisper en VRAM, soportando políticas
de keep-warm para eliminar latencia de carga en frío.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PersistentWhisperWorker</code></td>            <td>
                  <code><span title="v2m.infrastructure.persistent_model.PersistentWhisperWorker">PersistentWhisperWorker</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instancia configurada según config.toml.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>La primera llamada puede tardar varios segundos mientras carga
el modelo en GPU. Usa warmup() en startup para evitar esto.</p>
</details>
    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.get_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_status</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span></code>

<a href="#v2m.services.orchestrator.Orchestrator.get_status" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Retorna el estado actual del daemon de forma sincrónica.</p>
<p>Método ligero sin I/O, útil para health checks y polling.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>StatusResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.StatusResponse" href="../../../../api/backend/api/#v2m.api.StatusResponse">StatusResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estado de grabación ('idle'|'recording'),
flag booleano de grabación, y si el modelo está cargado.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>status = orchestrator.get_status()
if status.model_loaded:
...     print("Whisper listo")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retorna el estado actual del daemon de forma sincrónica.</span>

<span class="sd">    Método ligero sin I/O, útil para health checks y polling.</span>

<span class="sd">    Returns:</span>
<span class="sd">        StatusResponse: Estado de grabación (&#39;idle&#39;|&#39;recording&#39;),</span>
<span class="sd">            flag booleano de grabación, y si el modelo está cargado.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; status = orchestrator.get_status()</span>
<span class="sd">        &gt;&gt;&gt; if status.model_loaded:</span>
<span class="sd">        ...     print(&quot;Whisper listo&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">StatusResponse</span>

    <span class="n">state</span> <span class="o">=</span> <span class="s2">&quot;recording&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="k">else</span> <span class="s2">&quot;idle&quot;</span>

    <span class="k">return</span> <span class="n">StatusResponse</span><span class="p">(</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
        <span class="n">recording</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">,</span>
        <span class="n">model_loaded</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.process_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.process_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Procesa texto con LLM para limpieza, puntuación y formato.</p>
<p>Envía el texto al backend LLM configurado (Gemini/Ollama/local) para
refinamiento. El resultado se copia automáticamente al portapapeles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto crudo a procesar (típicamente output de Whisper).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.LLMResponse" href="../../../../api/backend/api/#v2m.api.LLMResponse">LLMResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto refinado y nombre del backend usado.
Si el LLM falla, retorna el texto original como fallback.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si el texto está vacío (capturado internamente).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.process_text("hola como estas")
print(response.text)  # "Hola, ¿cómo estás?"</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Procesa texto con LLM para limpieza, puntuación y formato.</span>

<span class="sd">    Envía el texto al backend LLM configurado (Gemini/Ollama/local) para</span>
<span class="sd">    refinamiento. El resultado se copia automáticamente al portapapeles.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Texto crudo a procesar (típicamente output de Whisper).</span>

<span class="sd">    Returns:</span>
<span class="sd">        LLMResponse: Texto refinado y nombre del backend usado.</span>
<span class="sd">            Si el LLM falla, retorna el texto original como fallback.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Si el texto está vacío (capturado internamente).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; response = await orchestrator.process_text(&quot;hola como estas&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(response.text)  # &quot;Hola, ¿cómo estás?&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>

    <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># El servicio LLM puede ser sync o async</span>
        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">):</span>
            <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">refined</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">process_text</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="c1"># Copiar al portapapeles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">refined</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">refined</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">refined</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error procesando texto con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Fallback: copiar texto original</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;⚠️ </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> falló&quot;</span><span class="p">,</span> <span class="s2">&quot;usando texto original...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (fallback)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.shutdown" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shutdown</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.shutdown" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Libera todos los recursos al apagar el servidor.</p>
<p>Detiene grabación activa, descarga el modelo de VRAM, y cierra
servicios de notificaciones. Llamado automáticamente en el
lifecycle shutdown de FastAPI.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>Los errores se logean pero no se re-lanzan para asegurar
un apagado limpio incluso con fallos parciales.</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>@asynccontextmanager
... async def lifespan(app: FastAPI):
...     await orchestrator.warmup()
...     yield
...     await orchestrator.shutdown()</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Libera todos los recursos al apagar el servidor.</span>

<span class="sd">    Detiene grabación activa, descarga el modelo de VRAM, y cierra</span>
<span class="sd">    servicios de notificaciones. Llamado automáticamente en el</span>
<span class="sd">    lifecycle shutdown de FastAPI.</span>

<span class="sd">    Note:</span>
<span class="sd">        Los errores se logean pero no se re-lanzan para asegurar</span>
<span class="sd">        un apagado limpio incluso con fallos parciales.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; @asynccontextmanager</span>
<span class="sd">        ... async def lifespan(app: FastAPI):</span>
<span class="sd">        ...     await orchestrator.warmup()</span>
<span class="sd">        ...     yield</span>
<span class="sd">        ...     await orchestrator.shutdown()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Liberando recursos del orquestador...&quot;</span><span class="p">)</span>

    <span class="c1"># Detener grabación si está activa</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">suppress</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

    <span class="c1"># Descargar modelo de VRAM</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker</span><span class="o">.</span><span class="n">unload</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error descargando modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Cerrar servicio de notificaciones</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notifications</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ Recursos liberados&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.start" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Inicia la grabación de audio y el streaming de transcripción.</p>
<p>Activa el AudioRecorder y el StreamingTranscriber. Crea un archivo
flag en disco para que scripts externos puedan detectar el estado.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../../../../api/backend/api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Confirmación de inicio con status='recording'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si ya hay una grabación en curso o el micrófono
no está disponible. (Error capturado en response.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>Si ya está grabando, retorna inmediatamente sin error.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicia la grabación de audio y el streaming de transcripción.</span>

<span class="sd">    Activa el AudioRecorder y el StreamingTranscriber. Crea un archivo</span>
<span class="sd">    flag en disco para que scripts externos puedan detectar el estado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ToggleResponse: Confirmación de inicio con status=&#39;recording&#39;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: Si ya hay una grabación en curso o el micrófono</span>
<span class="sd">            no está disponible. (Error capturado en response.message)</span>

<span class="sd">    Note:</span>
<span class="sd">        Si ya está grabando, retorna inmediatamente sin error.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;⚠️ Ya está grabando&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Iniciar streaming transcriber</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Crear flag file para scripts externos</span>
        <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>

        <span class="c1"># Notificar al usuario</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;🎤 voice2machine&quot;</span><span class="p">,</span> <span class="s2">&quot;grabación iniciada...&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🎙️ Grabación iniciada&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;recording&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;🎙️ Grabando...&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error iniciando grabación: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.stop" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stop</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.stop" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Detiene la grabación, finaliza transcripción y copia al portapapeles.</p>
<p>Detiene el AudioRecorder, procesa el audio capturado con Whisper,
y copia el texto resultante al portapapeles del sistema.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../../../../api/backend/api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resultado con status='idle' y el texto transcrito
en el campo 'text'. Si no se detectó voz, text=None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si no hay grabación en curso o Whisper falla.
(Error capturado en response.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.stop()
if response.text:
...     print(f"Copiado: {response.text}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detiene la grabación, finaliza transcripción y copia al portapapeles.</span>

<span class="sd">    Detiene el AudioRecorder, procesa el audio capturado con Whisper,</span>
<span class="sd">    y copia el texto resultante al portapapeles del sistema.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ToggleResponse: Resultado con status=&#39;idle&#39; y el texto transcrito</span>
<span class="sd">            en el campo &#39;text&#39;. Si no se detectó voz, text=None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: Si no hay grabación en curso o Whisper falla.</span>
<span class="sd">            (Error capturado en response.message)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; response = await orchestrator.stop()</span>
<span class="sd">        &gt;&gt;&gt; if response.text:</span>
<span class="sd">        ...     print(f&quot;Copiado: {response.text}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToggleResponse</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;⚠️ No hay grabación en curso&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Eliminar flag file</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">config</span><span class="o">.</span><span class="n">paths</span><span class="o">.</span><span class="n">recording_flag</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>

        <span class="c1"># Notificar procesamiento</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;⚡ v2m procesando&quot;</span><span class="p">,</span> <span class="s2">&quot;procesando...&quot;</span><span class="p">)</span>

        <span class="c1"># Detener y obtener transcripción</span>
        <span class="n">transcription</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">transcriber</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="c1"># Validar resultado</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">transcription</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">transcription</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;❌ whisper&quot;</span><span class="p">,</span> <span class="s2">&quot;no se detectó voz en el audio&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;❌ No se detectó voz&quot;</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Copiar al portapapeles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span>

        <span class="c1"># Notificar éxito</span>
        <span class="n">preview</span> <span class="o">=</span> <span class="n">transcription</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;✅ whisper - copiado&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">preview</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Transcripción completada: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">transcription</span><span class="p">)</span><span class="si">}</span><span class="s2"> chars&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;idle&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;✅ Copiado al portapapeles&quot;</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">transcription</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error deteniendo grabación: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">ToggleResponse</span><span class="p">(</span>
            <span class="n">status</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.toggle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">toggle</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.toggle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Alterna el estado de grabación del sistema.</p>
<p>Gestiona la lógica de cambio de estado: si el sistema está en reposo
(idle), inicia la captura de audio y el streaming. Si está grabando,
detiene la captura, finaliza la transcripción y copia al portapapeles.</p>
<p>Este es el endpoint principal usado por los atajos de teclado.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ToggleResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.ToggleResponse" href="../../../../api/backend/api/#v2m.api.ToggleResponse">ToggleResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Objeto con el nuevo estado del sistema y, en caso
de detenerse, el texto final transcrito.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si los servicios de backend (Whisper/Audio) no responden.
(Error capturado internamente y reportado en ToggleResponse.message)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.toggle()
if response.status == "idle" and response.text:
...     print(f"Transcrito: {response.text}")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ToggleResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Alterna el estado de grabación del sistema.</span>

<span class="sd">    Gestiona la lógica de cambio de estado: si el sistema está en reposo</span>
<span class="sd">    (idle), inicia la captura de audio y el streaming. Si está grabando,</span>
<span class="sd">    detiene la captura, finaliza la transcripción y copia al portapapeles.</span>

<span class="sd">    Este es el endpoint principal usado por los atajos de teclado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ToggleResponse: Objeto con el nuevo estado del sistema y, en caso</span>
<span class="sd">            de detenerse, el texto final transcrito.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: Si los servicios de backend (Whisper/Audio) no responden.</span>
<span class="sd">            (Error capturado internamente y reportado en ToggleResponse.message)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; response = await orchestrator.toggle()</span>
<span class="sd">        &gt;&gt;&gt; if response.status == &quot;idle&quot; and response.text:</span>
<span class="sd">        ...     print(f&quot;Transcrito: {response.text}&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_recording</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.translate_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.translate_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Traduce texto a otro idioma usando el LLM configurado.</p>
<p>Valida el idioma destino para prevenir inyección de prompts maliciosos,
luego delega al backend LLM para traducción.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto a traducir en cualquier idioma.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_lang</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Código o nombre del idioma destino (ej. 'en', 'español').
Debe coincidir con regex: ^[a-zA-Z\s-]{2,20}$</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LLMResponse</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="v2m.api.LLMResponse" href="../../../../api/backend/api/#v2m.api.LLMResponse">LLMResponse</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Texto traducido y backend usado.
Si hay error, retorna texto original con backend='error'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si target_lang tiene caracteres inválidos (sanitizado).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>response = await orchestrator.translate_text("Buenos días", "en")
print(response.text)  # "Good morning"</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">translate_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LLMResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Traduce texto a otro idioma usando el LLM configurado.</span>

<span class="sd">    Valida el idioma destino para prevenir inyección de prompts maliciosos,</span>
<span class="sd">    luego delega al backend LLM para traducción.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: Texto a traducir en cualquier idioma.</span>
<span class="sd">        target_lang: Código o nombre del idioma destino (ej. &#39;en&#39;, &#39;español&#39;).</span>
<span class="sd">            Debe coincidir con regex: ^[a-zA-Z\s\-]{2,20}$</span>

<span class="sd">    Returns:</span>
<span class="sd">        LLMResponse: Texto traducido y backend usado.</span>
<span class="sd">            Si hay error, retorna texto original con backend=&#39;error&#39;.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Si target_lang tiene caracteres inválidos (sanitizado).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; response = await orchestrator.translate_text(&quot;Buenos días&quot;, &quot;en&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(response.text)  # &quot;Good morning&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">v2m.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">LLMResponse</span>

    <span class="n">backend_name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">llm</span><span class="o">.</span><span class="n">backend</span>

    <span class="c1"># Validar target_lang para prevenir inyección</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^[a-zA-Z\s\-]{2,20}$&quot;</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Idioma inválido: </span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;❌ Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Idioma de destino inválido&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">):</span>
            <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">translated</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llm_service</span><span class="o">.</span><span class="n">translate_text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">target_lang</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clipboard</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">translated</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ Traducción (</span><span class="si">{</span><span class="n">target_lang</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">translated</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">translated</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend_name</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error traduciendo con </span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;❌ Error traducción&quot;</span><span class="p">,</span> <span class="s2">&quot;Fallo al traducir&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LLMResponse</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">backend_name</span><span class="si">}</span><span class="s2"> (error)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="v2m.services.orchestrator.Orchestrator.warmup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warmup</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#v2m.services.orchestrator.Orchestrator.warmup" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pre-carga el modelo Whisper en VRAM para eliminar latencia de arranque.</p>
<p>Ejecuta la inicialización sincrónica del worker en un executor para no
bloquear el event loop. Debe llamarse durante el lifecycle startup de
FastAPI para tener el modelo "caliente" antes de la primera transcripción.</p>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Si el worker no puede inicializarse (error silenciado
en logs, el modelo se cargará on-demand si falla aquí).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>@asynccontextmanager
... async def lifespan(app: FastAPI):
...     await orchestrator.warmup()
...     yield</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>apps/daemon/backend/src/v2m/services/orchestrator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-carga el modelo Whisper en VRAM para eliminar latencia de arranque.</span>

<span class="sd">    Ejecuta la inicialización sincrónica del worker en un executor para no</span>
<span class="sd">    bloquear el event loop. Debe llamarse durante el lifecycle startup de</span>
<span class="sd">    FastAPI para tener el modelo &quot;caliente&quot; antes de la primera transcripción.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: Si el worker no puede inicializarse (error silenciado</span>
<span class="sd">            en logs, el modelo se cargará on-demand si falla aquí).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; @asynccontextmanager</span>
<span class="sd">        ... async def lifespan(app: FastAPI):</span>
<span class="sd">        ...     await orchestrator.warmup()</span>
<span class="sd">        ...     yield</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Warmup sincrónico en el executor del worker</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_running_loop</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">initialize_sync</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_loaded</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;✅ Modelo Whisper precargado en VRAM&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error en warmup del modelo: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
show_source: true
members: - <strong>init</strong> - toggle - start - stop - warmup - shutdown - get_status - process_text - translate_text</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>